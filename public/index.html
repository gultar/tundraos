<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css" type="text/css"/>
    <link rel="stylesheet" href="./css/topnav.css" type="text/css"/>
    <link rel="stylesheet" href="./css/external/jquery-ui.min.js">
    <link rel="stylesheet" href="./css/external/jquery-ui.structure.min.css">
    <link rel="stylesheet" href="./css/external/jquery-ui.theme.min.css">
    <script src="./js/external/winbox.bundle.min.js"></script>
    <script src="./js/external/jquery-2.1.1.min.js"></script>
    <script  src="./js/external/jquery-ui.min.js"></script>
    <script src="./js/external/boxicons.js"></script>
    <script src="./js/external/ace.min.js"></script>
    <script src="./js/external/webamp.bundle.js"></script>
    <script src="./js/classes/virtualfilesystem.js"></script>
    <script src="./js/commands/web-cmds.js"></script>
    <script src="./js/applications/browser.js"></script>
    <script src="./js/applications/browser-history.js" ></script>
    <script src="./js/commands/settings.js"></script>
    <script src="./js/applications/webamp.js"></script>
    <script src="./js/terminal.js"></script>
    <script src="./js/terminal-window-init.js"></script>
    <script src="./js/applications/notepad.js"></script>
    <script src="./js/file-explorer/open-file.js"></script>
    <script src="./js/file-explorer/view-image.js"></script>
    <script src="./js/file-explorer/explore.js"></script>
    <script src="./js/filesystem-init.js"></script>
    <script src="./js/cmd-runner.js"></script>
    <script src="./js/applications/weather.js"></script>
    <script src="./js/external/particles.min.js"></script>
    <script src="./js/particlejs-init.js"></script>
    <script src="./js/init-script.js" defer></script>
    

    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <title>Document</title>
</head>
<body>
    <script>
        const getUsername = () =>{
            // console.log(window.location.href, searchParams)
            if(window.location.hostname == 'localhost'){
                const [ url, searchParams ] = window.location.href.split("?")
                const [ tokenAndValue, usernameAndValue ] = searchParams.split("&")
                let [ usernameLabel, value ] = usernameAndValue.split("=")
                value = value.replace("#", '')
                return value
            }else{
                return 'guest'
            }
            
        }
        const logout = async () =>{
            
            
            const [ url, searchParams ] = window.location.href.split("?")
            const username = getUsername()
            window.location.href = url
            
            if(window.location.hostname == 'localhost'){
                const loggedOut = await Promise.resolve($.post("/logout", {
                    logout:true,
                    username:username
                }))
            }

        }

        const reboot = () =>{
            const confirmed = confirm("Are you sure you want to reboot?")
            if(confirmed){
                location.reload()
            }else{
                return
            }
            
        }

        const shutdown = () =>{
            const confirmed = confirm("Are you sure you want to shutdown?")
            if(confirmed){
                window.close()
            }else{
                return
            }
            
        }
    </script>
    <div id="page-wrapper" class="flex">
        
        <nav id="topnav" class=".topnav">
            <ul >
                <li class="nav-item-group">
                    <li><a href="#">Menu</a>
                        <ul>
                            <li><a href="#" onClick="createTerminalWindow()"><img class="main-menu-icons" src="./images/icons/terminal.png" />Console</a></li>
                            <li><a href="#"><img class="main-menu-icons" src="./images/icons/settings.png" />Settings</a></li>
                            <li><a href="#" onClick="makeFileExplorer()"><img class="main-menu-icons" src="./images/icons/file-explorer.png" />Explorer</a></li>
                            <li><a href="#"><img class="main-menu-icons" src="./images/icons/internet.png" />Apps</a>
                            <ul>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/music.png" />Music</a>
                                    <ul>
                                        <li>
                                            <a onclick="runWebamp()"><img class="main-menu-icons" src="./images/icons/winamp.png" />Webamp</a>
                                        </li>
                                        <li><a onclick='runLofi()'><img class="main-menu-icons" src="./images/icons/music.png" />Lo-fi Girl</a></li>
                                    </ul>
                                </li>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/games.png" />Games</a>
                                    <ul>
                                        <li><a onclick="runWeb(['https://d07riv.github.io/diabloweb/'])"><img class="main-menu-icons" src="./images/diablo.png" />Diablo Web</a></li>
                                        <li><a onclick="runTirex()"><img class="main-menu-icons" src="./images/icons/Lonelytrex.webp" />Tirex Game</a></li>
                                        <li><a onclick="runWeb(['https://gba.js.org/'])"><img class="main-menu-icons" src="./images/icons/games.png" />Game Boy Advance</a></li>
                                        <li><a onclick="runWeb(['https://browserquest.io/'])"><img class="main-menu-icons" src="./images/icons/games.png" />BrowserQuest</a></li>
                                    </ul>
                                </li>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/browser.png" />Browser</a>
                                    <ul>
                                        <li><a onclick='runWeb(["https://www.google.com/webhp?igu=1"])'><img class="main-menu-icons" src="./images/icons/google.png" />Google</a></li>
                                        <li><a onclick="runLinguee([])"><img class="main-menu-icons" src="./images/icons/translation.png" />Linguee</a></li>
                                        <li><a onclick="runWeb(['https://gdt.oqlf.gouv.qc.ca/Resultat.aspx'])"><img class="main-menu-icons" src="./images/icons/dictionary.png" />GDT</a></li>
                                        <li><a onclick='runWeb(["https://wikipedia.org"])'><img class="main-menu-icons" src="./images/icons/wikipedia.png" />Wiki</a></li>
                                        <li><a onclick='runWeb(["https://gultar.github.io/iching/"])'><img class="main-menu-icons" src="./images/icons/yinyang.png" />I-Ching</a></li>
                                        <li><a onclick='runWeb(["https://georatio.com/"])'><img class="main-menu-icons" src="./images/icons/constellation.png" />Georatio</a></li>
                                        
                                    </ul>
                                </li>
                            </ul>
                            </li>
                            <li><a href="#"><img class="main-menu-icons" src="./images/icons/system.png" />System</a>
                                <ul>
                                    <li><a onclick="logout()">Logout</a></li>
                                    <li><a onclick="reboot()">Reboot</a></li>
                                    <li><a onclick="shutdown()">Shutdown</a></li>
                                </ul>
                            </li>
                        </ul>
                        </li>
                </li>
            </ul>
            <li class="clock-container">
                <span id="clock">
                </span>
            </li>
        </nav>

        <div id="page-anchor"></div>
        <div id="filemanager"></div>

        <div id="webamp"></div>
        <div id="main-container">
            <div id="logo-container"> 
                <!-- style="display:block;padding:20px;background: rgba(0, 0, 0, 0.6);box-shadow: 0 0 0 5px rgb(45, 52, 63);border-radius: 50%;position:fixed;top:40%;left:44%;" -->
                <img id="desktop-logo" src="./images/icons/desktop-logo-3.png" style="">
            </div>
            <canvas class="background"></canvas>
        </div>
        <div id="browser-view" style="width:100%; height:100%; visibility:hidden;">
            
        </div>
        <div id="dialog-message" title="System Message">
            
        </div>
        
    </div>
    <script type="text/javascript">
        const popup = (...text) =>{
            $("#dialog-message").append(...text)
            $( "#dialog-message" ).dialog();
        }

        function disableF5(e) { if ((e.which || e.keyCode) == 116 || (e.which || e.keyCode) == 82) e.preventDefault(); };
        
        $(document).ready(function(){
             $(document).on("keydown", (e)=>{
                // console.log('Muppet')
                // disableF5(e)
             });
        });
    </script>

</body>
</html>
