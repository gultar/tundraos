<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css" type="text/css"/>
    <link rel="stylesheet" href="./css/topnav.css" type="text/css"/>
    <link rel="stylesheet" href="./css/external/jquery-ui.min.js">
    <link rel="stylesheet" href="./css/external/jquery-ui.structure.min.css">
    <link rel="stylesheet" href="./css/external/jquery-ui.theme.min.css">
    <link rel="stylesheet" href="./css/external/jquery.contextMenu.min.css">
    <link rel="stylesheet" href="./css/editor.css">
    <link rel="stylesheet" href="./css/hyperwatch.css">
    <!-- External scripts -->
    <script src="./js/external/winbox.bundle.min.js"></script>
    <script src="./js/external/vanilla-context-menu.js"></script>
    <script src="./js/external/jquery-2.1.1.min.js"></script>
    <script src="./js/external/jquery.contextMenu.min.js"></script>
    <script  src="./js/external/jquery-ui.min.js"></script>
    <script src="./js/external/socket.io.min.js"></script> 
    <script src="./js/external/boxicons.js"></script> <!-- Icons -->
    <script src="./js/terminal/hyperwatcher.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js"></script> Code editor7
    <!-- Filesystem related scripts -->
    <script src="./js/filesystem/filesystem.bundle.js"></script>
    <script src="./js/commands/execute.js"></script>
    <!-- Browser related scripts -->
    <script src="./js/browser/browser.js"></script>
    <script src="./js/commands/web-shortcuts.js"></script>
    <!-- Settings and configurations -->
    <script src="./js/settings/settings.js"></script>
    <!-- Terminal/Shell scripts -->
    <script src="./js/terminal/terminal.js"></script>
    <script src="./js/terminal/terminal-window-init.js"></script>
    <!-- Code editor scripts -->
    <script src="./js/external/get-extension.js"></script>
    <script src="./js/applications/editor.js"></script>
    <!-- File explorer scripts -->
    <script src="./js/file-explorer/collapsible-sidebar.js"></script>
    <script src="./js/file-explorer/explorer.js"></script>
    <script src="./js/file-explorer/save-as-dialog.js"></script>
    <!-- Applications and visual effects -->
    <script src="./js/applications/weather.js"></script>
    <script src="./js/external/particles.min.js"></script>
    <script src="./js/settings/particlejs-init.js"></script>
    <!-- Desktop tools -->
    <script src="./js/desktop/desktop-menu.js"></script>
    <script src="./js/desktop/context-window.js"></script>
    <script src="./js/desktop/icon-creator.js"></script>
    <script src="./js/window-manager/create-window.js"></script> 
    <!-- Init scripts -->
    
    <script src="./js/init-script.js" defer></script>

    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <title>Document</title>
</head>
<body>
    <div id="page-wrapper" class="flex">
        <div id="color-focus"></div>
        <nav id="topnav">
            <ul >
                <li class="nav-item-group">
                    <li><a href="#" >Menu</a>
                        <ul>
                            <li><a href="#"><img class="main-menu-icons" src="./images/icons/settings.png" />Settings</a></li>
                            <li><a href="#"><img class="main-menu-icons" src="./images/icons/internet.png" />Apps</a>
                            <ul>
                                <li><a href="#" onClick="createTerminalWindow()"><img class="main-menu-icons" src="./images/icons/terminal.png" />Terminal</a></li>
                                <li><a href="#" onClick="new FileExplorer(0,0)"><img class="main-menu-icons" src="./images/icons/file-explorer.png" />Explorer</a></li>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/music.png" />Programming</a>
                                    <ul>
                                        <li><a onclick='new Editor()'><img class="main-menu-icons" src="./images/icons/terminal.png" />Editor</a></li>
                                    </ul>
                                </li>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/music.png" />Music</a>
                                    <ul>
                                        <li><a onclick='runLofi()'><img class="main-menu-icons" src="./images/icons/music.png" />Lo-fi Girl</a></li>
                                    </ul>
                                </li>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/games.png" />Games</a>
                                    <ul>
                                        <li><a onclick="runWeb(['https://d07riv.github.io/diabloweb/'])"><img class="main-menu-icons" src="./images/diablo.png" />Diablo Web</a></li>
                                        <li><a onclick="runTirex()"><img class="main-menu-icons" src="./images/icons/Lonelytrex.webp" />Tirex Game</a></li>
                                        <li><a onclick="runWeb(['https://gba.js.org/'])"><img class="main-menu-icons" src="./images/icons/games.png" />Game Boy Advance</a></li>
                                        <li><a onclick="runWeb(['https://browserquest.io/'])"><img class="main-menu-icons" src="./images/icons/games.png" />BrowserQuest</a></li>
                                    </ul>
                                </li>
                                <li><a href="#"><img class="main-menu-icons" src="./images/icons/browser.png" />Browser</a>
                                    <ul>
                                        <li><a onclick='runWeb(["https://www.google.com/webhp?igu=1"])'><img class="main-menu-icons" src="./images/icons/google.png" />Google</a></li>
                                        <li><a onclick="runLinguee([])"><img class="main-menu-icons" src="./images/icons/translation.png" />Linguee</a></li>
                                        <li><a onclick="runWeb(['https://gdt.oqlf.gouv.qc.ca/Resultat.aspx'])"><img class="main-menu-icons" src="./images/icons/dictionary.png" />GDT</a></li>
                                        <li><a onclick='runWeb(["https://wikipedia.org"])'><img class="main-menu-icons" src="./images/icons/wikipedia.png" />Wiki</a></li>
                                        <li><a onclick='runWeb(["https://gultar.github.io/iching/"])'><img class="main-menu-icons" src="./images/icons/yinyang.png" />I-Ching</a></li>
                                        <li><a onclick='runWeb(["https://georatio.com/"])'><img class="main-menu-icons" src="./images/icons/constellation.png" />Georatio</a></li>
                                        
                                    </ul>
                                </li>
                            </ul>
                            </li>
                            <li><a href="#"><img class="main-menu-icons" src="./images/icons/system.png" />System</a>
                                <ul>
                                    <li><a onclick="logout()">Logout</a></li>
                                    <li><a onclick="reboot()">Reboot</a></li>
                                    <li><a onclick="shutdown()">Shutdown</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </li>
            </ul>
            <li class="clock-container">
                <span id="clock">
                </span>
            </li>
        </nav>

        <div id="page-anchor"></div>
        <div id="filemanager"></div>

        <div id="editor-container"></div>
        
        <div id="main-container">
            
            <!-- <div id="logo-container"> 
                <img id="desktop-logo" src="./images/icons/constellation-3.png">
            </div> -->

            <div id="icon-container" style="background:transparent">
                <a data-name="browser-icon" class="desktop-icon-link" onclick="select(this, launchBrowser)" id="browser-icon">
                    <img class="desktop-icon" src="./images/icons/browser-color-large.png">
                    <span>Browser</span>
                </a>
                <a data-name="explorer-icon" class="desktop-icon-link" onclick="select(this, (()=>new FileExplorer(0,0)))" id="explorer-icon">
                    <img class="desktop-icon" src="./images/icons/explorer-color-large.png">
                    <span>Explorer</span>
                </a>
                <a data-name="terminal-icon" class="desktop-icon-link" onclick="select(this, createTerminalWindow)" id="terminal-icon">
                    <img class="desktop-icon" src="./images/icons/terminal-color-large.png">
                    <span>Terminal</span>
                </a>
                <a data-name="editor-icon" class="desktop-icon-link" onclick="select(this, (()=>new Editor()))" id="editor-icon">
                    <img class="desktop-icon" src="./images/icons/editor-color-large.png">
                    <span>Editor</span>
                </a>
            </div>

            <canvas class="background" ></canvas>
            <div id="webamp"></div>
        </div>
        
        <div id="browser-view" style="width:80%; height:80%;"></div>
        <div id="dialog-message" title="System Message"></div>

    </div>
    <script type="text/javascript">

        makeDesktopMenu()

        function disableF5(e) { if ((e.which || e.keyCode) == 116) e.preventDefault(); };
        
        //Forces user to "reboot" instead of refreshing
        // $(document).ready(function(){
        //      $(document).on("keydown", (e)=>{
        //         disableF5(e)
        //      });
        // });

        $("#icon-container").sortable()
        // $(".desktop-icon-link").draggable()

        const select = (element, func) =>{
            if(element.classList.contains('selected')){
                func()
                element.classList.remove('selected')
            }else{
                element.classList.add('selected')
                setTimeout(()=>{
                    element.classList.remove('selected')
                }, 1000)
            }
        }

        //prevent dragging start menu elements
        $("nav a").on('dragstart drop', function(e){
            e.preventDefault();
            return false;
        });

        const getUsername = () =>{
            //Probably useless
            if(window.location.hostname == 'localhost'){
                const [ url, searchParams ] = window.location.href.split("?")
                const [ tokenAndValue, usernameAndValue ] = searchParams.split("&")
                let [ usernameLabel, value ] = usernameAndValue.split("=")
                value = value.replace("#", '')
                return value
            }else{
                return 'guest'
            }
            
        }



        const logout = async () =>{
            
            const [ url, searchParams ] = window.location.href.split("?")
            const username = getUsername()
            window.location.href = url
            
            if(window.location.hostname == 'localhost'){
                const loggedOut = await Promise.resolve($.post("/logout", {
                    logout:true,
                    username:username
                }))
            }

        }

        const reboot = () =>{
            confirmation({
                message:"Are you sure you want to reboot?",
                yes:()=>{
                    window.openWindows = {}
                    if(location.hostname === 'localhost')
                        location.href = location.origin
                    else
                        location.reload()
                },
                no:()=>{}
            })
        }

        const shutdown = () =>{
            confirmation({
                message:"Are you sure you want to shutdown?",
                yes:()=>{
                    window.openWindows = {}
                    window.close()
                },
                no:()=>{}
            })
        }
        // (function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()
    </script>


</body>
</html>

